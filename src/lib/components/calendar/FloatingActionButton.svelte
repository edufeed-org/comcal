<script>
	import { PlusIcon, CalendarIcon } from '$lib/components/icons';
	import { manager } from '$lib/stores/accounts.svelte';
	import CalendarEventModal from './CalendarEventModal.svelte';
	import CalendarCreationModal from './CalendarCreationModal.svelte';

	// Event modal state
	let isEventModalOpen = $state(false);
	let selectedDateForNewEvent = $state(/** @type {Date | null} */ (null));

	// Calendar modal state
	let isCalendarModalOpen = $state(false);

	/**
	 * Handle creating a new event
	 */
	function handleCreateEvent() {
		selectedDateForNewEvent = new Date();
		isEventModalOpen = true;
	}

	/**
	 * Handle creating a new calendar
	 */
	function handleCreateCalendar() {
		isCalendarModalOpen = true;
	}
	
	/**
	 * Handle event modal close
	 */
	function handleEventModalClose() {
		isEventModalOpen = false;
		selectedDateForNewEvent = null;
	}

	/**
	 * Handle calendar modal close
	 */
	function handleCalendarModalClose() {
		isCalendarModalOpen = false;
	}

	/**
	 * Handle event created
	 */
	function handleEventCreated() {
		// Event was created successfully
		// Could add a toast notification here
	}

	/**
	 * Handle calendar created
	 */
	function handleCalendarCreated() {
		// Calendar was created successfully
		// Could add a toast notification here
	}
</script>

<!-- Floating Action Button Container -->
<div 
	class="fab fixed z-50"
	style="bottom: 1.5rem; right: 1.5rem;"
>
	<!-- Main FAB Button -->
	<div 
		tabindex="0" 
		role="button" 
		class="btn btn-lg btn-circle btn-primary shadow-lg hover:shadow-xl"
		aria-label="Open actions menu"
	>
		<PlusIcon class_="h-6 w-6" />
	</div>

	<!-- Action buttons that show up when FAB is open -->
	<button 
		class="btn btn-lg btn-circle tooltip tooltip-left" 
		data-tip="Create Event"
		onclick={handleCreateEvent}
		aria-label="Create new event"
	>
		<CalendarIcon class_="h-5 w-5" />
	</button>
	
	<button 
		class="btn btn-lg btn-circle tooltip tooltip-left" 
		data-tip="Create Calendar"
		onclick={handleCreateCalendar}
		aria-label="Create new calendar"
	>
		<svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
			<path
				stroke-linecap="round"
				stroke-linejoin="round"
				stroke-width="2"
				d="M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"
			/>
		</svg>
	</button>
</div>

<!-- Event Creation Modal -->
<CalendarEventModal
	isOpen={isEventModalOpen}
	communityPubkey=""
	selectedDate={selectedDateForNewEvent}
	onClose={handleEventModalClose}
	onEventCreated={handleEventCreated}
/>

<!-- Calendar Creation Modal -->
<CalendarCreationModal
	isOpen={isCalendarModalOpen}
	onClose={handleCalendarModalClose}
	onCalendarCreated={handleCalendarCreated}
/>
